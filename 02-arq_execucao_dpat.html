<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Equipe Lapig CEPF">
  
  <link rel="shortcut icon" href="img/favicon.ico">
  <title>Deployment da arquitetura do CEPF - Documentação - Plataforma de Conhecimento CEPF</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Deployment da arquitetura do CEPF";
    var mkdocs_page_input_path = "02-arq_execucao_dpat.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="js/jquery-2.1.1.min.js" defer></script>
  <script src="js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> Documentação - Plataforma de Conhecimento CEPF</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="index.html">HOME</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Guia do usuário</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="01-guia_dados_geograficos.html">Dados Geográficos</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="01-guia_funcionalidades.html">Funcionalidades</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Dados</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="03-dad_vetoriais.html">Banco de Dados</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Arquitetura de Software</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="02-arq_geral.html">Visão geral</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="02-arq_servidor_de_mapas.html">Servidor de mapas</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="02-arq_servidor_de_aplicacao.html">Servidor de aplicação</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="02-arq_execucao_dpat.html">Deployment da arquitetura do CEPF</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#restaurando-e-disponibilizando-o-banco-de-dados-lapig">Restaurando e disponibilizando o banco de dados lapig</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deployment-da-aplicacao-plataforma-de-conhecimento-do-cerrado">Deployment da aplicação Plataforma de Conhecimento do Cerrado</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ambiente-de-desenvolvimento">Ambiente de Desenvolvimento</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ambiente-de-producao">Ambiente de Produção</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Documentação - Plataforma de Conhecimento CEPF</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Arquitetura de Software &raquo;</li>
        
      
    
    <li>Deployment da arquitetura do CEPF</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="introducao">Introdução</h1>
<p>Conforme detalhado na seção <a href="/02-arq_geral">Arquitetura de Software</a>, para execução da Plataforma de Conhecimento do Cerrado são necessárias 3 estruturas criadas e funcionais na máquina do usuário:</p>
<ol>
<li>
<p>O Banco de Dados <code>lapig</code> restaurado no serviço do PostgreSQL devidamente instalado com a extensão PostGis.</p>
</li>
<li>
<p>O serviço <em>OWS Server</em> devidamente configurado e executando em um IP e porta.</p>
</li>
<li>
<p>O <em>Application Server</em> e client (Front-end) da aplicação compilados e executando.</p>
</li>
</ol>
<h2 id="restaurando-e-disponibilizando-o-banco-de-dados-lapig">Restaurando e disponibilizando o banco de dados lapig</h2>
<p>Para restaurar o banco <code>lapig</code> no PostgreSQL, é necessário ter o serviço PostgreSQL executando na máquina do usuário. Para tal, pode-se utilizar o tutorial neste <a href="https://medium.com/@thiago.reis/instalando-e-configurando-postgresql-no-ubuntu-86716cda5894">link</a> para instalar e executar o PostgreSQL e o PGAdmin3.</p>
<p>Ao final do tutorial, deve-se verificar qual a versão do PostgreSQL instalado (ver: <a href="https://phoenixnap.com/kb/check-postgresql-version">link</a>) e também instalar a extensão do Postgis para a versão adequada de acordo com o tutorial deste <a href="https://computingforgeeks.com/how-to-install-postgis-on-ubuntu-debian/">link</a> no <strong>Step 4: Install PostGIS on Ubuntu 20.04/18.04 / Debian 10</strong>.</p>
<p>Com o PostgreSQL e o PostGIS instalados, em seguida é necessário realizar o download do último backup disponibilizado no <a href="https://drive.google.com/file/d/19nVhry3bvHpV_oY861saBV9prXpfnFtd/view?usp=sharing">endereço</a> e extraí-lo.</p>
<pre><code class="language-sh">$ tar -xfv BKP_BANCO_DADOS_LAPIG.tar.gz
</code></pre>
<p>Em seguida, deve-se exportar a variável de senha do banco de dados configurada anteriormente.</p>
<pre><code class="language-sh">$ export PGPASSWORD= &lt;db_password&gt;
</code></pre>
<p>Após exportação da senha, deve criar o banco de dados no serviço PostgreSQL. Este passo pode ser realizado por linha de comando ou com ajuda do PGAdmin3. Ambos os passos estão demonstrados abaixo.</p>
<pre><code class="language-sh">$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -c &quot;create database lapig;&quot;
</code></pre>
<p>Após a criação do banco de dados, deve-se criar as extensões do PostGis e PlPGSql para uso das funções na aplicação.</p>
<pre><code class="language-sh">$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d lapig -c &quot;create extension postgis;&quot;

$ psql -h &lt;host_address&gt; -U &lt;db_user&gt; -d lapig -c &quot;create extension plpgsql;&quot;
</code></pre>
<p>Agora de fato pode-se restaurar o banco de dados baixado e extraído para a database <code>lapig</code> criada, o que pode ser alcançada através do comando.</p>
<pre><code class="language-sh">$ pg_restore -U lapig -h &lt;host_address&gt; -v -j 24 --format=d -C -d lapig lapig.sql/
</code></pre>
<h2 id="deployment-da-aplicacao-plataforma-de-conhecimento-do-cerrado">Deployment da aplicação Plataforma de Conhecimento do Cerrado</h2>
<p>Para execução da Plataforma de Conhecimento do Cerrado é importante ressaltar que o Banco de Dados deve estar restaurado e acessível conforme abordado na <a href="/02-arq_execucao_dpat/#restaurando-e-disponibilizando-o-banco-de-dados-fip-cerrado">seção</a> e também deve-se ter o <a href="/02-arq_execucao_dpat/#execucao-do-ows-server">OWS Server</a> funcionando corretamente.</p>
<p>Conforme mencionado anteriormente, a estrutura do OWS Server foi construída com o apoio do <a href="https://www.docker.com/">Docker</a>, portanto para instalação do mesmo, deve-se seguir os passos definidos nos tutoriais de acordo com o sistema operacional, seja ele <a href="https://docs.docker.com/engine/install/debian/">Debian</a> ou <a href="https://docs.docker.com/engine/install/centos/">CentOS</a>. Além do Docker, o script também faz uso das seguintes dependências:</p>
<table>
<thead>
<tr>
<th align="center">Dependência</th>
<th>Tutorial para Instalação</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Perl</td>
<td><a href="https://learn.perl.org/installing/unix_linux.html">https://learn.perl.org/installing/unix_linux.html</a></td>
</tr>
<tr>
<td align="center">wget</td>
<td><a href="https://www.cyberciti.biz/faq/how-to-install-wget-togetrid-of-error-bash-wget-command-not-found/">https://www.cyberciti.biz/faq/how-to-install-wget-togetrid-of-error-bash-wget-command-not-found/</a></td>
</tr>
<tr>
<td align="center">curl</td>
<td><a href="https://www.cyberciti.biz/faq/how-to-install-curl-command-on-a-ubuntu-linux/">https://www.cyberciti.biz/faq/how-to-install-curl-command-on-a-ubuntu-linux/</a></td>
</tr>
<tr>
<td align="center">Git</td>
<td><a href="https://gist.github.com/derhuerst/1b15ff4652a867391f03">https://gist.github.com/derhuerst/1b15ff4652a867391f03</a></td>
</tr>
<tr>
<td align="center">Docker</td>
<td><a href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></td>
</tr>
<tr>
<td align="center">Docker Compose</td>
<td><a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></td>
</tr>
</tbody>
</table>
<p>A seguir será abordado duas maneiras de executar a aplicaçãa Plataforma de Conhecimento do Cerrado em ambientes de Desenvolvimento e Produção. Para o ambiente de desenvolvimento será detalhado um passo a passo partindo do pressuposto que um programador irá dar manutenção ou continuidade na Plataforma de Conhecimento do Cerrado. Já o ambiente de produção, será disponibilizado um script que executa todos os passos para disponibilizar a Plataforma de Conhecimento do Cerrado em uma porta da máquina que está sendo executado. </p>
<p>Em seguida, certifique-se de criar corretamente um arquivo <code>.env</code> conforme abordado na <a href="02-arq_servidor_de_aplicacao.md/#servidor-de-aplicacao">seção</a>. Um exemplo de arquivo <code>.env</code> criado durante o processo de execução do script para o ambiente de Produção pode ser observado abaixo:</p>
<pre><code>APP_PRODUCAO='/data/dados-lapig/dpat-files'
APP_PRODUCAO_CEPF='/data/dados-lapig/cepf-files'
CLIENT_DIR='/../client/dist/lapig-cepf-cerrado/'
LANG_DIR='/lang'
LOG_DIR='/log/'
TMP='/tmp/'
FIELD_DATA_DIR='/media/campo/'
UPLOAD_DATA_DIR='/uploads/'
DOWNLOAD_DIR='/data/dados-lapig/download_atlas/'
DOWNLOAD_DATA_DIR='/downloads-cepf/'

PG_USER='db_user'
PG_HOST='127.0.0.1'
PG_DATABASE='lapig'
PG_PASSWORD='db_password'
PG_PORT='db_port'
PG_DEBUG=true

PORT=3000
OWS_HOST='http://172.18.0.8:5000'
OWS_DOMAINS='http://172.18.0.8:5000'
</code></pre>
<h3 id="ambiente-de-desenvolvimento">Ambiente de Desenvolvimento</h3>
<p>Assim como abordado na <a href="/02-arq_geral/#arquitetura-de-software">seção</a>, a Plataforma de Conhecimento do Cerrado foi construído com NodeJS como <em>Application Server</em> e Angular como cliente (<em>WebMap Client</em>). Portanto, primeiramente é necessária a instalação destes componentes na máquina do desenvolvedor. Para tal, pode-se seguir o passo-a-passo elaborado neste <a href="https://www.tecmint.com/install-angular-cli-on-linux/">link</a></p>
<p>Para execução da Plataforma de Conhecimento do Cerrado em ambiente de desenvolvimento, primeiramente é necessário realizar um <a href="https://github.com/UNIVALI-LITE/Portugol-Studio/wiki/Fazendo-um-Fork-do-reposit%C3%B3rio"><code>fork</code></a> do projeto para a sua conta pessoal do Github e em seguida executar um <a href="https://docs.github.com/pt/free-pro-team@latest/github/creating-cloning-and-archiving-repositories/cloning-a-repository"><code>git clone</code></a> do <a href="https://github.com/lapig-ufg/cepf-cerrado-platform">repositório do projeto</a>.</p>
<p>Para inicializar o servidor de aplicação (<em>Application Server</em>) deve-se executar o passo-a-passo descrito na <a href="/02-arq_servidor_de_aplicacao/#servidor-de-aplicacao">seção</a>. A execução da mesma irá inicializar o <em>Application Server</em> em localhost na porta 3000.</p>
<p>Em seguida, para inicializar o <em>WebMap Client</em> localizado na pasta <a href="https://github.com/lapig-ufg/d-pat/tree/master/src/client"><code>src/client</code></a>, basta navegar até a pasta <strong>client</strong> e instalar as dependências listadas no <strong>package.json</strong> através do comando:</p>
<pre><code>$ npm install
</code></pre>
<p>Após a devida instalação das dependências, pode-se então compilar e inicializar a aplicação. Mais uma vez, a fim de facilitar, foi criado um script <a href="https://github.com/lapig-ufg/cepf-cerrado-platform/blob/master/src/client/start.sh"><code>start.sh</code></a> para inicializar o <em>WebMap Client</em>, portanto basta executar:</p>
<pre><code>$ ./src/client/start.sh
</code></pre>
<p>Ao finalizar a compilação do projeto, a aplicação estará executando em localhost na porta padrão do Angular, que é a porta 4200. Portanto, para acessar a página Web criada pela aplicação, acesse pelo navegador:</p>
<pre><code>http://localhost:4200
</code></pre>
<h3 id="ambiente-de-producao">Ambiente de Produção</h3>
<p>Em seguida, uma segunda maneira de disponibilizar a Plataforma de Conhecimento do Cerrado é em ambiente de produção. É importante ressaltar que o <em>OWS Server</em> deve estar executando para que a Plataforma de Conhecimento do Cerrado faça as requisições de imagens das diferentes camadas utilizadas pelo sistema.</p>
<p>Para facilitar o processo de <em>deployment</em> em produção, foi criado um <a href="https://drive.google.com/file/d/1vH3BGK_KmU_n1nTDv5qCKh6rvNx4bSS7/view?usp=sharing">script</a> que realiza todos os passos necessários para execução da Plataforma de Conhecimento do Cerrado em produção. Para executar o script basta executar em um Terminal:</p>
<pre><code class="language-sh">$ ./start-cepf+ows.sh
</code></pre>
<p>Assim como detalhado na seção de <a href="/02-arq_execucao_dpat/#execucao-do-ows-server">Deployment do OWS Server</a>, este script irá pedir ao usuário que informe os parâmetros <strong>endereço, nome, porta, usuário e senha</strong> do Banco de Dados, de forma a alterar corretamente o arquivo de configuração do ambiente, <code>.env</code> corretamente.</p>
<p>Em seguida, após pedir as informações do Banco de Dados, o script irá pedir ao usuário que informe o local onde a estrutura de pastas da Plataforma de Conhecimento do Cerrado deverá ser criada e também qual o endereço de IP da máquina de produção onde será realizado o <em>deployment</em> assim como informado nas imagens abaixo.</p>
<p><img alt="Senha do BD" src="imgs/02/ows-standalone/CEPF01.png" /></p>
<p><img alt="Senha do BD" src="imgs/02/ows-standalone/CEPF02.png" /></p>
<p><img alt="Senha do BD" src="imgs/02/ows-standalone/CEPF03.png" /></p>
<p>Basicamente o script deverá criar e ajustar automaticamente as variáveis de ambiente da Plataforma de Conhecimento do Cerrado, realizar o download e importação do <a href="https://drive.google.com/file/d/1QKiBeo9II2auQik1jJdBACnHp4qrfc0f/view?usp=sharing">contâiner docker</a> onde todas as dependências do projeto já estão devidamente ajustadas e executar os passos necessários para compilar e disponibilizar a aplicação no endereço de IP informado na execução do script na <strong>porta 3000</strong>, assim como apresentado na imagem abaixo.</p>
<p>Após execução dos scripts o OWS Server estará executando na máquina do usuário na porta <strong>5000</strong> e a Plataforma de Conhecimento do Cerrado também na máquina do usuário na porta <strong>3000</strong>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="02-arq_servidor_de_aplicacao.html" class="btn btn-neutral" title="Servidor de aplicação"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="02-arq_servidor_de_aplicacao.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '.';</script>
    <script src="js/theme_extra.js" defer></script>
    <script src="js/theme.js" defer></script>
      <script src="search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
